# Дисклеймер... грустный...: В проекте не реализован реальный Parser Service, вместо него используется заглушка в get_rate и локальный JSON‑кэш rates.json.

# ValutaTrade Hub (CLI)

Учебное CLI‑приложение для управления простым портфелем валют.  
Хранит данные в JSON‑файлах, поддерживает кэширование курсов и бизнес‑логику покупки/продажи.

## Идея и возможности

Приложение позволяет:

- регистрировать и аутентифицировать пользователей;
- хранить портфель по пользователям с несколькими кошельками (по коду валюты);
- покупать и продавать валюту по упрощённому курсу;
- получать курс одной валюты к другой с локальным кэшем и контролем свежести (TTL);
- логировать доменные операции (`BUY`, `SELL`) с помощью декоратора `@log_action`.

Основная цель проекта — отработать ООП (иерархия валют), пользовательские исключения, Singleton‑конфигурацию, работу с JSON‑хранилищем и базовое логирование.

## Структура каталогов

```text
finalproject_shitova_natalia/
│
├── data/
│   ├── users.json          # пользователи
│   ├── portfolios.json     # портфели и кошельки
│   └── rates.json          # кэш курсов
│
├── valutatrade_hub/
│   ├── __init__.py
│   ├── logging_config.py   # настройка логирования и ротации логов
│   ├── decorators.py       # @log_action для логирования операций
│   ├── core/
│   │   ├── __init__.py
│   │   ├── currencies.py   # иерархия Currency / FiatCurrency / CryptoCurrency + реестр
│   │   ├── exceptions.py   # пользовательские исключения (CurrencyNotFoundError и др.)
│   │   ├── models.py       # User, Portfolio, Wallet
│   │   ├── usecases.py     # бизнес‑логика: register/login/show-portfolio/buy/sell/get-rate
│   │   └── utils.py        # работа с JSON, валидация, кэш курсов
│   ├── infra/
│   │   ├── __init__.py
│   │   ├── settings.py     # Singleton SettingsLoader (конфигурация из pyproject.toml)
│   │   └── database.py     # (зарезервировано под абстракцию JSON‑хранилища)
│   └── cli/
│       ├── __init__.py
│       └── interface.py    # CLI‑обработчики команд
│
├── main.py                 # точка входа (опционально)
├── Makefile
├── pyproject.toml
├── README.md
└── .gitignore
```

# Установка

```
poetry install
```

# Запуск

```
poetry run project
```

# После запуска вы попадёте в REPL:

```
ValutaTrade Hub CLI. Введите команду (help для справки, exit для выхода).
```

# Выход:

```
> exit
```


# Основные команды CLI

Ниже примеры базового сценария.

Регистрация и вход

> register --username alice --password 1234
Пользователь 'alice' зарегистрирован (id=1). Войдите: login --username alice --password ****

> login --username alice --password 1234
Вы вошли как 'alice'

# Просмотр портфеля

> show-portfolio
# при пустом портфеле:
У пользователя пока нет ни одного кошелька

# После покупок:

> show-portfolio
+--------+---------+-------------------+
| Валюта | Баланс  | Стоимость в USD   |
+--------+---------+-------------------+
| BTC    | 0.0500  | 0.0500            |
| USD    | 100.00  | 100.00            |
+--------+---------+-------------------+
Итого в USD: 100.05

# Покупка валюты

> buy --currency BTC --amount 0.01
Покупка выполнена: 0.0100 BTC (Bitcoin) по курсу 1.00 USD/BTC
Изменения в портфеле:
- BTC: было 0.0400 → стало 0.0500
Оценочная стоимость покупки: 0.01 USD

# Ошибки:

    неверный amount:

> buy --currency BTC --amount -1
'amount' должен быть положительным числом

    неизвестная валюта:
    
> buy --currency QQQ --amount 1
Неизвестная валюта 'QQQ'
Используйте 'help get-rate' или посмотрите список поддерживаемых валют.

# Продажа валюты

> sell --currency BTC --amount 0.005
Продажа выполнена: 0.0050 BTC (Bitcoin) по курсу 1.00 USD/BTC
Изменения в портфеле:
- BTC: было 0.0500 → стало 0.0450
Оценочная выручка: 0.01 USD


Ошибки:

    кошелёк не найден:

> sell --currency DOGE --amount 1
У вас нет кошелька 'DOGE'. Добавьте валюту: она создаётся автоматически при первой покупке.

> sell --currency DOGE --amount 1
У вас нет кошелька 'DOGE'. Добавьте валюту: она создаётся автоматически при первой покупке.


    недостаточно средств:
    
> sell --currency BTC --amount 999999
Недостаточно средств: доступно 0.0450 BTC, требуется 999999.0000 BTC


# Курс валют (get-rate)

> get-rate --from USD --to BTC
Курс USD→BTC: 0.00001685 (обновлено: 2026-02-11 14:41:40)
Обратный курс BTC→USD: 59347.18


Ошибки:

    неизвестный код валюты:


> get-rate --from QQQ --to BTC
Неизвестная валюта 'QQQ'
Используйте 'help get-rate' или проверьте код валюты.


неподдерживаемая пара (пример с существующими валютами, для которых нет заглушки):

> get-rate --from USD --to RUB
Ошибка при обращении к внешнему API: Курс USD→RUB недоступен. Повторите попытку позже.
Попробуйте повторить позже или проверьте сеть.


> get-rate --from USD --to RUB
Ошибка при обращении к внешнему API: Курс USD→RUB недоступен. Повторите попытку позже.
Попробуйте повторить позже или проверьте сеть.


#Логирование операций

Логирование настраивается в logging_config.py и включается при старте CLI. Используется:

    формат строк (по умолчанию человекочитаемый);

    ротация лог‑файла logs/actions.log по размеру.

Декоратор @log_action в decorators.py оборачивает операции buy_currency и sell_currency и записывает события уровня INFO:

    timestamp в ISO‑формате;

    action (BUY/SELL);

    user_id;

    currency, amount, base;

    result (OK/ERROR);

    при ошибке — error_type и error_message;

    при verbose=True — краткие изменения портфеля (details).

Пример строки:

2026-02-11T15:16:17 action=BUY user_id=1 currency='BTC' amount=0.01 base='USD' result=OK details='Изменения в портфеле: ...'

Файл логов по умолчанию:

logs/actions.log


## Демонстрация

По ссылке показан полный цикл: register → login → buy/sell → show-portfolio → get-rate; демонстрация обработки ошибок .

https://asciinema.org/a/G8kvY9oMFsPboVCq



